# Frigate in Home Assistant – Step-by-Step Setup & Configuration Guide

This video covers installing the Frigate add-on, configuring frigate.yaml to add IP or USB cameras, and enabling object detection. You’ll also learn how to set up MQTT credentials and add the Frigate HACS integration, which converts detected objects into entities you can use to trigger automations in Home Assistant.

▶️ [Watch the video here](https://youtu.be/PwqESoIVcqc)  

### ⚙️ Frigate configuration files used in this video

- **[Frigate_IP_Cam_ONLY](https://github.com/LazyTechGeek/HomeAssistant-Frigate/blob/main/frigate_ip_cam_only.yaml)**
- **[Frigate_USB_and_IP_Cam](https://github.com/LazyTechGeek/HomeAssistant-Frigate/blob/main/frigate_usb_and_ip_cam.yaml)**

### 🪢 Demo Node-RED Process Flow:

``
[{"id":"banana_state","type":"server-state-changed","z":"tab_banana_person_flags","name":"Banana Detected","server":"ha_server","version":6,"outputs":2,"exposeAsEntityConfig":"","entities":{"entity":["binary_sensor.ipcam_banana_occupancy_3"],"substring":[],"regex":[]},"outputInitially":false,"stateType":"str","ifState":"on","ifStateType":"str","ifStateOperator":"is","outputOnlyOnStateChange":true,"for":"","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[],"x":120,"y":80,"wires":[["banana_flag"],[]]},{"id":"banana_flag","type":"function","z":"tab_banana_person_flags","name":"bananaRecentlyDetected = true (extend 5s)","func":"const KEY='bananaRecentlyDetected';\nconst TIMER='bananaTimer';\nconst WINDOW=5000;\n// set true\nflow.set(KEY, true);\n// extend/reset timer\nlet t = flow.get(TIMER);\nif (t) clearTimeout(t);\n\nt = setTimeout(() => {\n    flow.set(KEY, false);\n    node.status({fill:'red',shape:'ring',text:'banana OFF'});\n}, WINDOW);\nflow.set(TIMER, t);\nnode.status({fill:'green',shape:'dot',text:'banana ON'});\n// ask gate to check now\nreturn { topic: 'check' };","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":80,"wires":[["gate_both_true","7464b50963295515"]]},{"id":"person_state","type":"server-state-changed","z":"tab_banana_person_flags","name":"Person Detected","server":"ha_server","version":6,"outputs":2,"exposeAsEntityConfig":"","entities":{"entity":["binary_sensor.ipcam_person_occupancy_3"],"substring":[],"regex":[]},"outputInitially":false,"stateType":"str","ifState":"on","ifStateType":"str","ifStateOperator":"is","outputOnlyOnStateChange":true,"for":"","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[],"x":120,"y":200,"wires":[["person_flag"],[]]},{"id":"person_flag","type":"function","z":"tab_banana_person_flags","name":"personRecentlyDetected = true (extend 5s)","func":"const KEY='personRecentlyDetected';\nconst TIMER='personTimer';\nconst WINDOW=5000;\nflow.set(KEY, true);\nlet t = flow.get(TIMER);\nif (t) clearTimeout(t);\n\nt = setTimeout(() => {\n    flow.set(KEY, false);\n    node.status({fill:'red',shape:'ring',text:'person OFF'});\n}, WINDOW);\nflow.set(TIMER, t);\nnode.status({fill:'green',shape:'dot',text:'person ON'});\nreturn { topic: 'check' };","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":200,"wires":[["gate_both_true"]]},{"id":"gate_both_true","type":"function","z":"tab_banana_person_flags","name":"Gate: both true? (+60s cooldown)","func":"const banana = flow.get('bananaRecentlyDetected') === true;\nconst wine = flow.get('wineRecentlyDetected') === true;\nconst person = flow.get('personRecentlyDetected') === true;\n\nconst now = Date.now();\nconst COOLDOWN = 60000; // 60s\n\nconst lastBanana = flow.get('lastBananaFireTs') || 0;\nconst lastWine = flow.get('lastWineFireTs') || 0;\n\nif (person && banana && (now - lastBanana > COOLDOWN)) {\n    flow.set('lastBananaFireTs', now);\n    msg.payload = \"Good, you are eating a healthy Banana. If I catch drinking wine, I'll post on Facebook to humiliate you\";\n    return msg;\n}\n\nif (person && wine && (now - lastWine > COOLDOWN)) {\n    flow.set('lastWineFireTs', now);\n    msg.payload = \"Put the wine down! or I'll post on facebook!\";\n    return msg;\n}\n\nreturn null;\n","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":820,"y":160,"wires":[["debug_fire","343a1d4e3ebbadce"]]},{"id":"debug_fire","type":"debug","z":"tab_banana_person_flags","name":"FIRED (wire this to Alexa)","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1130,"y":220,"wires":[]},{"id":"343a1d4e3ebbadce","type":"alexa-remote-routine","z":"tab_banana_person_flags","name":"","account":"b33322c55db794d1","routineNode":{"type":"speak","payload":{"type":"regular","text":{"type":"msg","value":"payload"},"devices":["GN42ML05416500EF"]}},"x":1100,"y":160,"wires":[[]]},{"id":"adf68fa4529837af","type":"server-state-changed","z":"tab_banana_person_flags","name":"Wine Glass Detected","server":"ha_server","version":6,"outputs":2,"exposeAsEntityConfig":"","entities":{"entity":["binary_sensor.ipcam_wine_glass_occupancy_2"],"substring":[],"regex":[]},"outputInitially":false,"stateType":"str","ifState":"on","ifStateType":"str","ifStateOperator":"is","outputOnlyOnStateChange":true,"for":"","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[],"x":140,"y":260,"wires":[["1064a7f6a09061c9"],[]]},{"id":"1064a7f6a09061c9","type":"function","z":"tab_banana_person_flags","name":"wineRecentlyDetected = true (extend 5s)","func":"const KEY='wineRecentlyDetected';\nconst TIMER='wineTimer';\nconst WINDOW=5000;\n// set true\nflow.set(KEY, true);\n// extend/reset timer\nlet t = flow.get(TIMER);\nif (t) clearTimeout(t);\n\nt = setTimeout(() => {\n    flow.set(KEY, false);\n    node.status({fill:'red',shape:'ring',text:'wine OFF'});\n}, WINDOW);\nflow.set(TIMER, t);\nnode.status({fill:'green',shape:'dot',text:'wine ON'});\n// ask gate to check now\nreturn { topic: 'check' };","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":260,"wires":[["gate_both_true","7464b50963295515"]]},{"id":"7464b50963295515","type":"api-current-state","z":"tab_banana_person_flags","name":"Person detected","server":"2754f7d8.e47878","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.ipcam_person_occupancy_3","state_type":"str","blockInputOverrides":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":500,"y":140,"wires":[["person_flag"],[]]},{"id":"ha_server","type":"server","name":"Home Assistant","addon":true},{"id":"b33322c55db794d1","type":"alexa-remote-account","name":"Alexa Live","authMethod":"proxy","proxyOwnIp":"192.168.1.144","proxyPort":3456,"cookieFile":"/config/alexa_cookies_live","refreshInterval":"3","alexaServiceHost":"alexa.amazon.co.uk","amazonPage":"amazon.co.uk","acceptLanguage":"en-UK","userAgent":"","useWsMqtt":"on","autoInit":"on"},{"id":"2754f7d8.e47878","type":"server","name":"Home Assistant","addon":true}]
``
